<!-- PROJECT LOGO -->
  <h1 align="center">GlORIE-SLAM: Globally Optimized RGB-only Implicit Encoding Point Cloud SLAM</h1>
  <p align="center">
    <a href="https://ganlinzhang.xyz" target="_blank"><strong>Ganlin Zhang<sup>1</sup>*</strong></a>
    ·
    <a href="https://eriksandstroem.github.io/" target="_blank"><strong>Erik Sandström<sup>1</sup>*</strong></a>
    ·
    <a href="https://youmi-zym.github.io/" target="_blank"><strong>Youmin Zhang<sup>2,3</sup></strong></a>
    ·
    <a href="https://manthan99.github.io/" target="_blank"><strong>Manthan Patel<sup>1</sup></strong></a>
    <br>
    <a href="https://vision.ee.ethz.ch/people-details.OTAyMzM=.TGlzdC8zMjcxLC0xOTcxNDY1MTc4.html" target="_blank"><strong>Luc Van Gool<sup>1,4,5</sup></strong></a>
    ·
    <a href="https://cvg.ethz.ch/team/Dr-Martin-R-Oswald" target="_blank"><strong>Martin R. Oswald<sup>1,6</sup></strong></a>
  </p>
  <p align="center">
      <strong><sup>1 </sup>ETH Zurich,  <sup>2 </sup>University of Bologna, <sup>3 </sup>Rock Universe, <sup>4 </sup>KU Leuven, <sup>5 </sup>INSAIT, <sup>6 </sup>University of Amsterdam</strong>
      <br>(<strong>*</strong> Equal Contribution)
      <strong><h4 align="center"><a href="https://arxiv.org/abs/2403.19549" target="_blank">Paper</a> | <a href="https://ganlinzhang.xyz/GlORIE-SLAM/" target="_blank">Project Website</a></h4></strong>
  </strong></p>
    


## Installation
1. Creating a new conda environment using the provided `glorie_env.yaml` file.

```bash
conda env create -f glorie_env.yaml
conda activate glorie-slam
```
2. Compile and install thirdparty libraries.
```bash
pip install thirdparty/evaluate_3d_reconstruction_lib
python setup.py install
```

3. Download pretrained model.
Download the pretained models from [Google Drive](https://drive.google.com/file/d/1oZbVPrubtaIUjRRuT8F-YjjHBW-1spKT/view?usp=drive_link), unzip them inside the `pretrained` folder.
<details>
  <summary>[Directory structure of pretrianed (click to expand)]</summary>
  
```bash
  .
  └── pretrained
        ├── .gitkeep
        ├── droid.pth
        ├── middle_fine.pt
        └── omnidata_dpt_depth_v2.ckpt

```
</details>

## Data Download

### Replica
Download the data as below and the data is saved into the `./datasets/Replica` folder. Note that the Replica data is generated by the authors of iMAP (but hosted by the authors of NICE-SLAM). Please cite iMAP if you use the data.
```bash
bash scripts/download_replica.sh
```
To be able to evaluate the reconstruction error, download the ground truth Replica meshes where unseen region have been culled.

```bash
bash scripts/download_cull_replica_mesh.sh
```

### TUM-RGBD
```bash
bash scripts/download_tum.sh
```
DATAROOT is `./datasets` by default. Please change the `input_folder` path in the scene specific config files if stored somewhere else on your machine.


## Run
To run GlORIE-SLAM with logging, [weights and biases](https://wandb.ai/) can be used. This can be turned on by setting the `wandb` flag to True in the `configs/*.yaml` file. Also make sure to specify the path `wandb_folder`. If you don't have a wandb account, first create one. Each scene has a config folder, where the `input_folder`,`output` paths need to be specified. Below, we show some example run commands for one tiny scene from each dataset.

### Replica
To run GlORIE-SLAM on the `office0` scene, run the following command. 
```bash
python run.py configs/Replica/demo_office0.yaml
```
After reconstruction, the trajectory error will be evaluated and so will the mesh accuracy along with the rendering metrics.

### TUM-RGBD
To run GlORIE-SLAM on the `freiburg3_office` scene, run the following command. 
```bash
python run.py configs/TUM_RGBD/demo_freiburg3_office.yaml
```
After reconstruction, the trajectory error will be evaluated automatically.

## Run tracking without mapping
Our GlORIE-SLAM pipeline uses two processes for tracking and mapping, and it is possible to run tracking only without mapping/rendering. In case you only want to test the `DSPO` part of our paper, add `--only_tracking`in each of the above commands.
```bash
python run.py configs/Replica/demo_office0.yaml --only_tracking
python run.py configs/TUM_RGBD/demo_freiburg3_office.yaml --only_tracking
python run.py configs/Scannet/demo_scene0000.yaml --only_tracking
```

